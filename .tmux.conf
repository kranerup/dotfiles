set-option -g prefix C-w
unbind-key C-b
bind-key C-w send-prefix
bind-key v split-window -h
bind-key i split-window ipython


set -g mouse on
set-window-option -g mode-keys vi
set -s escape-time 0


set -g default-terminal "screen-256color"
set-option -g history-limit 300000

bind-key -n M-PageUp   previous-window
bind-key -n M-PageDown next-window

# smart pane switching with awareness of vim splits
#is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
#bind -n C-Left if-shell "$is_vim" "send-keys C-h" "select-pane -L"
#bind -n C-Down if-shell "$is_vim" "send-keys C-j" "select-pane -D"
#bind -n C-Up if-shell "$is_vim" "send-keys C-k" "select-pane -U"
#bind -n C-Right if-shell "$is_vim" "send-keys C-l" "select-pane -R"


# ==== latest config ========================
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
# so we can do C-w C-l to clear screen
bind C-l send-keys 'C-l'
# so we can do C-w C-k to do emacs kill command in bash
bind C-k send-keys 'C-k'
# ===========================================



# bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# same keys for pane switching in non-vim splits
#bind -n C-h select-pane -L
#bind -n C-j select-pane -D
#bind -n C-k select-pane -U
#bind -n C-l select-pane -R


bind-key v if-shell "$is_vim" "send-keys C-w v" "split-window -h"
bind-key s if-shell "$is_vim" "send-keys C-w s" "split-window -v"
bind-key c if-shell "$is_vim" "send-keys C-w c" "confirm-before -p 'kill-pane #P? (y/n)' kill-pane"
bind-key -n PageUp if-shell "$is_vim" "send-keys PageUp" "copy-mode -u"
set -g terminal-overrides "xterm*:kLFT5=\eOD:kRIT5=\eOC:kUP5=\eOA:kDN5=\eOB:smkx@:rmkx@"

# some VIM keys that we should pass on (otherwise captured by TMUX since the prefix is the same)
bind-key f send-keys C-w f

#set -g @continuum-restore 'on'
#set -g @continuum-save-interval '15'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-resurrect'
#set -g @plugin 'tmux-plugins/tmux-continuum'
#set -g @plugin 'tmux-plugins/tmux-logging'

#set -g status-right 'Continuum status: #{continuum_status}'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

set-option -g window-status-format "#I:#W#F#{?pane_synchronized,S,}"
set-window-option -g window-status-current-format "#{?pane_synchronized,#[bg=red],}#{?window_zoomed_flag,#[bg=yellow],} #I:#W#F#{?pane_synchronized,S,}"

set -g pane-active-border-style bg=default,fg=magenta
set -g pane-border-style fg=red

set-hook -g client-attached 'run-shell /home/users/kenny/bin/update_display.sh'

set-option -g word-separators " @:"

# -----
set-hook -g alert-activity "display-popup -E -w 50 -h 12 'whiptail --msgbox DONE 10 30'"

bind-key m if -F '#{monitor-activity}'      'set-window-option monitor-activity off; display-message "Monitor OFF"'      'set-window-option monitor-activity on; display-message "Monitor ON"'

# tmux show-options monitor-activity

# need C-w = in vim
unbind-key -T prefix =
